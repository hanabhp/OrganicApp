
@using Microsoft.Extensions.Options
@using waterfood.Core.Objects.Externals;
@inject IOptions<ReCaptchaSettings> ReCapOptions
@{
    ViewData["Title"] = "Authentication";
    Layout = "_Layout";

}

<!-- start main -->

<div class="container my-5 py-5">
    <div class="row d-flex justify-content-center my-5">
        <div class="col-md-5 col-12">
            <div class="card border-primary shadow">
                <div class="card-header bg-white text-center">
                    <h5>Sign in to Fam Powder Coating</h5>

                </div>
                <div class="card-body pt-0 mt-0">
                    <div class="row text-center">
                        <div class="col-12 m-0 p-0">
                            <div id="login-loading" class="cart-linear-activity m-0 p-0 d-none">
                                <div class="cart-indeterminate"></div>
                            </div>
                        </div>
                        <div class="col-12 mx-0 px-0 mt-4 mb-3">
                            <img src="/front/assets/img/logo/logo-simple.png" class="d-block mx-auto" alt="logo" />
                            <br />
                        </div>


                    </div>
                    <div class="row text-center px-3">
                        <div class="col-12">
                            <div class="row align-items-center justify-content-center">
                                <div class="col-md-10 col-12">
                                    <input type="email" name="mail" id="mail" placeholder="Email" class="form-control"><br />
                                </div>
                                <div class="col-md-10 col-12">
                                    <input type="password" name="password" id="password" placeholder="Password" class="form-control"><br />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 d-flex justify-content-center align-content-center">
                            <div id="recaptcha_div"></div>
                            <input type="hidden" id="google" value="" />

                        </div>
                        <div class="col-12">

                            <a onclick="login();"
                               class="btn btn-primary mt-4">
                                Login
                                <i class="fa fa-user mx-2"></i>

                            </a> <br>
                            <br />
                        </div>
                        <div class="col-12">
                            <div id="msg" class="alert alert-warning text-danger d-none">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="row text-center">
                        <div class="col-md-12 col-12">
                            <a href="/forgotPassword" class="btn btn-sm btn-outline-secondary mb-2">
                                <small>Forgot your PASSWORD?</small>
                            </a>
                            <br />
                            <a href="/register" class="btn btn-sm btn-outline-secondary">
                                <small>Create new ACCOUNT</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- end main -->
@section Scripts
    {
    <script src="https://www.google.com/recaptcha/api.js?render=@ReCapOptions.Value.SiteKey"></script>
    <script asp-append-version="true" src="~/front/assets/js/pages/account.js"></script>

    <script>
             var onloadCallback = function() {
            grecaptcha.render('recaptcha_div',
                {
                    'sitekey': '@ReCapOptions.Value.SiteKey',
                    'callback': correctCaptcha
                });
        };

        var correctCaptcha = function(response) {
            console.log(response);
            $("#google").val(response);
        };

        function login() {

            $('#btn-login').addClass("d-none");
            $('#login-loading').removeClass("d-none");

            var mail = $("#mail").val();
            var password = $("#password").val();
            var rememberMe = $("#rememberMe").val();
            var temp = $("#google").val();


            if (mail.length > 0 && password.length > 0 && temp.length > 0) {

                $.ajax({
                    type: "get",
                    url: "/loginAjax/" + mail + "?password=" + password
                        + "&rememberMe=" + rememberMe
                        + "&google=" + temp,
                    success: function (result) {

                        $('#btn-login').removeClass("d-none");
                        $('#login-loading').addClass("d-none");

                        if (result === "correct") {
                            window.location.replace("/");
                        }
                        else {
                            grecaptcha.reset();
                            $('#msg').removeClass("d-none");
                            $('#msg').html(result);
                            $('#login-loading').addClass("d-none");

                        }
                    }
                });
            }
            else {
                if (temp.length <= 0) {

                    $('#msg').removeClass("d-none");
                    $('#msg').html("Please complete captcha!");
                    $('#login-loading').addClass("d-none");
                }
                else {
                    $('#msg').removeClass("d-none");
                    $('#msg').html("Enter Email and Password!");
                    $('#login-loading').addClass("d-none");

                }

            }


        }


    </script>
}

